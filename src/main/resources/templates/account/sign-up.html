<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>회원가입</title>
  <div th:replace="/fragments/header.html :: header-main"></div>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-U1DAWAznBHeqEIlVSCgzq+c9gqGAJn5c/t99JyeKa9xxaYpSvHU5awsuZVVFIhvj" crossorigin="anonymous"></script>
  <script src="/node_modules/jdenticon/dist/jdenticon.min.js"></script>

  <script src="/js/common.js"></script>

  <link rel="stylesheet" href="//code.jquery.com/ui/1.8.18/themes/base/jquery-ui.css" />
  <script src="//code.jquery.com/ui/1.8.18/jquery-ui.min.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>

</head>
<body>
  <div th:replace="/fragments/nav.html :: nav-main"/>
  <div class="container">
    <div class="row p-3">
      <div class="col-sm-6">
        <p class="fs-2 py-2">로그인 정보 (필수)</p>
        <div class="mb-3">
          <label for="username" class="form-label">아이디</label>
          <input class="form-control" id="username" aria-describedby="username-help">
          <div id="username-help" class="form-text" >아이디는 4자 이상, 16자 이하로 입력해주세요.</div>
          <small id="username-warn" class="form-text text-danger warn-message d-none">아이디 오류</small>
        </div>
        <div class="mb-3">
          <label for="email" class="form-label">이메일</label>
          <input type="email" class="form-control" id="email" aria-describedby="email-help">
          <div id="email-help" class="form-text" >이메일은 회원가입 확인용 및 그룹알람용으로만 활용됩니다.</div>
          <small id="email-warn" class="form-text text-danger warn-message d-none">이메일 오류</small>
        </div>
        <div class="mb-3">
          <div class="row">
            <div class="col" aria-describedby="password-help">
              <label for="password" class="form-label">비밀번호</label>
              <input type="password" class="form-control" id="password">
            </div>
            <div class="col">
              <label for="password-confirm" class="form-label">비밀번호 재입력</label>
              <input type="password" class="form-control" id="password-confirm">
            </div>
            <div class="col-1">
            </div>
          </div>
          <div id="password-help" class="form-text">비밀번호는 8자이상, 20자 이하로 입력해주세요.</div>
          <small id="password-warn" class="form-text text-danger warn-message d-none">비밀번호 오류</small>
          <small id="password-not-match" class="form-text text-danger warn-message d-none">비밀번호가 일치하지 않습니다.</small>
        </div>
        <p class="fs-2 py-2">개인 정보 (선택)</p>
        <p class="fs-normal">- 개인정보는 사이트내 그룹 추천 및 통계외에 활용되지 않습니다.</p>
        <div class="row">
          <div class="col mb-3">
            <label for="lastname" class="form-label">성</label>
            <input class="form-control" id="lastname">
          </div>
          <div class="col mb-3">
            <label for="firstname" class="form-label">이름</label>
            <input class="form-control" id="firstname">
          </div>
        </div>
        <div class="mb-3">
          <label for="birth" class="form-label">생년월일</label>
          <input class="form-control" id="birth">
          <small id="birth-warn" class="form-text text-danger warn-message d-none">생년월일 오류</small>
        </div>

        <div class="mb-3">
          <label for="sex" class="form-label">성별</label>
          <input type="email" class="form-control" id="sex">
        </div>
        <div class="mb-3">
          <label for="cellPhone" class="form-label">핸드폰 번호</label>
          <input class="form-control" id="cellPhone">
          <small id="cellPhone-warn" class="form-text text-danger warn-message d-none">핸드폰번호 오류</small>
        </div>
        <div class="mb-3">
          <label for="address" class="form-label">주소</label>
          <input class="form-control" id="address">
        </div>

        <button class="btn btn-primary" id="submit">가입하기</button>
      </div>
    </div>
  </div>
  <div th:replace="/fragments/footer.html :: footer"/>
</body>

<script>

  $(document).on('change', '#password-confirm', function(){
    if($("#password").val() !== $("#password-confirm").val()){
      $("#password-not-match").removeClass('d-none');
    } else {
      $("#password-not-match").addClass('d-none');
    }
  })

  $("#submit").on('click', function(){
    let param = {};
    $("input").each(
      function(){
        let field = $(this).attr('id');
        let value = $(this).val();
        if(field !== undefined && field !== "password-confirm" && value !== undefined && value.length > 0){
          param[field] = value;
        }
    });

    post("/api/account",param
            ,function(result){
              window.location.href="/login";
            }
            ,function(status, responseText){
              hideAllWarnMessages();
              if(checkObjectType(responseText) == "Array"){
                $(responseText).each(function(index){
                  let field = responseText[index]["field"];
                  let message = responseText[index]["message"];
                  $(`.warn-message[id=${field}-warn]`).text(message).removeClass('d-none');
                })
              } else {
                console.log(responseText);
              }
            }
    );
  })

  function hideAllWarnMessages(){
    $('.warn-message').each(function(){
      if(!$(this).hasClass('d-none')){
        $(this).addClass('d-none')
      }
    });
  }

  //date picker
  $.datepicker.setDefaults({
    dateFormat: 'yymmdd',
    prevText: '이전 달',
    nextText: '다음 달',
    monthNames: ['1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월', '12월'],
    monthNamesShort: ['1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월', '12월'],
    dayNames: ['일', '월', '화', '수', '목', '금', '토'],
    dayNamesShort: ['일', '월', '화', '수', '목', '금', '토'],
    dayNamesMin: ['일', '월', '화', '수', '목', '금', '토'],
    showMonthAfterYear: true,
    yearSuffix: '년'
  });

  $( function() {
    $( "#birth" ).datepicker( "option", "showAnim", "Slide down" );
  } );
</script>

